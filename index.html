<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilal Abboud - Laser Scientist & Engineer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Main Site Styles --- */
        :root {
            --primary-bg: #f4f4f4;
            --secondary-bg: #ffffff;
            --header-bg: #333;
            --text-color: #333;
            --text-light: #f1f1f1;
            --accent-color: #007bff;
            --border-color: #e0e0e0;
            --wip-bg: #fff3cd;
            --wip-text: #664d03;
            --wip-border: #ffc107;
        }
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.7;
            margin: 0;
            background-color: var(--primary-bg);
            color: var(--text-color);
        }
        .main-header {
            background-color: var(--header-bg);
            color: var(--text-light);
            padding: 0 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .header-container { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
        .logo a { color: inherit; text-decoration: none; }
        .logo h1 { margin: 0; font-size: 1.5rem; }
        .main-nav a { color: var(--text-light); text-decoration: none; padding: 1.5rem 1rem; display: inline-block; transition: background-color 0.2s; }
        .main-nav a:hover { background-color: #444; }
        .main-nav a.active { background-color: var(--accent-color); }
        .wip-banner { background-color: var(--wip-bg); color: var(--wip-text); text-align: center; padding: 0.75rem 1rem; font-size: 0.95rem; border-bottom: 1px solid var(--wip-border); }
        .main-content { max-width: 900px; margin: 2rem auto; padding: 0 2rem; }
        .content-panel { display: none; background-color: var(--secondary-bg); padding: 2rem; border-radius: 8px; animation: fadeIn 0.5s; }
        .content-panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .category-card, .tool-card { background: #f9f9f9; padding: 1.5rem 2rem; border: 1px solid var(--border-color); border-radius: 5px; margin-bottom: 1rem; cursor: pointer; transition: all 0.2s ease-in-out; }
        .category-card:hover, .tool-card:hover { border-color: var(--accent-color); box-shadow: 0 4px 12px rgba(0,0,0,0.08); transform: translateY(-2px); }
        .category-card h3, .tool-card h3 { margin-bottom: 0.25rem; }
        .category-card p, .tool-card p { margin: 0; color: #666; }
        .project-preview { display: flex; gap: 1.5rem; align-items: center; padding: 1rem; border: 1px solid var(--border-color); border-radius: 5px; margin-bottom: 1rem; cursor: pointer; transition: all 0.2s ease-in-out; }
        .project-preview:hover { border-color: var(--accent-color); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .preview-image { width: 150px; height: 100px; object-fit: cover; border-radius: 4px; flex-shrink: 0; }
        .preview-text-content { flex: 1; position: relative; height: 6.8em; overflow: hidden; }
        .preview-text-content h3 { margin-top: 0; margin-bottom: 0.5rem; }
        .preview-text-content p { color: #666; margin: 0; }
        .preview-text-content::after { content: ''; position: absolute; bottom: 0; right: 0; width: 100%; height: 2.5em; background: linear-gradient(to bottom, transparent, var(--secondary-bg)); }
        .breadcrumbs { margin-bottom: 1.5rem; font-size: 1rem; color: #555; }
        .breadcrumbs span { cursor: pointer; color: var(--accent-color); }
        .breadcrumbs span:hover { text-decoration: underline; }
        .back-button { display: inline-block; background: none; border: none; color: var(--accent-color); font-size: 1rem; font-weight: bold; cursor: pointer; padding: 0.5rem 0; margin-bottom: 1.5rem; }
        .blog-post-content h3 { margin-top: 0; font-size: 1.8rem; }
        .blog-post-content h4 { font-size: 1.5rem; margin-top: 2.5rem; border-bottom: 1px solid #eee; padding-bottom: 0.5rem; }
        .blog-post-content h5 { font-size: 1.2rem; margin-top: 2rem; }
        .blog-post-content img { max-width: 100%; height: auto; border-radius: 5px; margin: 1.5rem 0; display: block; border: 1px solid var(--border-color); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .disclaimer { background-color: #fffbe6; border-left: 4px solid #ffc107; padding: 1rem; margin: 1.5rem 0; }
        pre { background-color: #2d2d2d; color: #f8f8f2; padding: 1em; overflow-x: auto; border-radius: 5px; font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; font-size: 0.9em; white-space: pre-wrap; word-wrap: break-word; }

        /* --- NIST Viewer Modal Styles --- */
        .viewer-modal-overlay {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
            align-items: center; justify-content: center;
        }
        .viewer-modal-content {
            background-color: #111827;
            padding: 1rem; border: 1px solid #374151; width: 95%; height: 95%;
            border-radius: 0.5rem; color: #d1d5db; display: flex; flex-direction: column;
        }
        .viewer-modal-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 1rem; border-bottom: 1px solid #374151; }
        .viewer-modal-header h2 { font-size: 1.5rem; font-bold: 700; }
        .viewer-modal-close { font-size: 2rem; font-weight: bold; cursor: pointer; color: #9ca3af; line-height: 1; }
        .viewer-modal-close:hover { color: white; }
        .viewer-modal-body { flex-grow: 1; overflow-y: auto; padding-top: 1rem; }
        .periodic-table-grid { display: grid; grid-template-columns: repeat(18, minmax(0, 1fr)); gap: 4px; }
        .element-cell { grid-column: span 1 / span 1; transition: all 0.2s ease-in-out; aspect-ratio: 1 / 1; display: flex; align-items: center; justify-content: center; cursor: pointer; border-radius: 0.375rem; font-weight: 600; font-size: 0.75rem; }
        .element-cell:not(:disabled):hover { transform: scale(1.1); z-index: 10; box-shadow: 0 0 15px rgba(59, 130, 246, 0.5); }
        .element-cell.selected { box-shadow: 0 0 0 2px #3b82f6; transform: scale(1.1); }
        .element-cell:disabled { cursor: not-allowed; opacity: 0.4; }
        .alkali { background-color: #ef4444; color: white; }
        .alkaline-earth { background-color: #f97316; color: white; }
        .lanthanide { background-color: #8b5cf6; color: white; }
        .actinide { background-color: #d946ef; color: white; }
        .transition { background-color: #3b82f6; color: white; }
        .post-transition { background-color: #22d3ee; color: white; }
        .metalloid { background-color: #10b981; color: white; }
        .nonmetal { background-color: #84cc16; color: white; }
        .noble-gas { background-color: #6366f1; color: white; }
        .comparison-item button { background-color: #ef4444; color: white; border: none; border-radius: 50%; width: 1.5rem; height: 1.5rem; font-weight: bold; cursor: pointer; line-height: 1.5rem; transition: background-color 0.2s ease; }
        .comparison-item button:hover { background-color: #dc2626; }
        .finder-result-item:hover { background-color: #374151; }
        .file-upload-btn { background-color: #3b82f6; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; cursor: pointer; transition: background-color 0.2s; }
        .file-upload-btn:hover { background-color: #2563eb; }
        .resize-handle { width: 100%; height: 10px; cursor: ns-resize; background-color: #374151; border-top: 1px solid #4b5563; border-bottom: 1px solid #4b5563; border-radius: 2px; margin-top: auto; }
        #compare-toggle:checked ~ .block { background-color: #14b8a6; }
        #compare-toggle:checked ~ .dot { transform: translateX(1.5rem); }
        .finder-modal { display: none; position: fixed; z-index: 2050; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); backdrop-filter: blur(4px); align-items: center; justify-content: center; }
        .finder-modal-content { background-color: #1f2937; margin: auto; padding: 2rem; border: 1px solid #374151; width: 90%; max-width: 500px; border-radius: 0.5rem; color: #d1d5db; }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="header-container">
            <div class="logo">
                <a href="#" id="logo-link"><h1>Bilal Abboud</h1></a>
            </div>
            <nav class="main-nav">
                <a href="#" class="nav-link active" data-target="projects">Projects</a>
                <a href="#" class="nav-link" data-target="tools">Tools</a>
                <a href="#" class="nav-link" data-target="about">About Me</a>
                <a href="#" class="nav-link" data-target="contact">Contact</a>
            </nav>
        </div>
    </header>

    <div class="wip-banner">
        <strong>Note:</strong> This website is a work in progress. More content and projects will be added soon!
    </div>

    <main class="main-content">
        <div id="projects" class="content-panel active">
            <div class="breadcrumbs">Projects</div>
            <div id="category-list" class="view">
                <h2>Project Categories</h2>
                <div class="category-card" data-category="spectroscopy"><h3>Spectroscopy</h3><p>Analysis and modification of spectroscopic instruments.</p></div>
                <div class="category-card" data-category="microscopy"><h3>Microscopy</h3><p>Custom-built microscopic tools and imaging systems.</p></div>
                <div class="category-card" data-category="night-vision"><h3>Night Vision</h3><p>Exploring and building devices for low-light imaging.</p></div>
            </div>
            <div id="project-list" class="view" style="display: none;"></div>
            <div id="project-full-view" class="view" style="display: none;"></div>
        </div>
        
        <div id="tools" class="content-panel">
            <h2>Tools</h2>
            <p class="text-gray-600 mb-4">A collection of web-based utilities for scientific and engineering tasks.</p>
            <div id="tool-list">
                <div class="tool-card" id="launch-nist-viewer">
                    <h3>Atomic Spectra Viewer</h3>
                    <p>An interactive tool to browse and compare emission spectra from the NIST Atomic Spectra Database.</p>
                </div>
                <div class="tool-card" style="opacity: 0.5; cursor: not-allowed;">
                    <h3>Spectrometer Calibration Calculator</h3>
                    <p>A tool to calculate calibration coefficients from spectral lamp data. (Coming Soon)</p>
                </div>
            </div>
        </div>

        <div id="about" class="content-panel">
            <h2>About Me</h2>
            <p>Hello! I'm Bilal Abboud, a young laser scientist and engineer from Berlin. This website showcases some of the personal projects I've worked on.</p>
        </div>

        <div id="contact" class="content-panel">
            <h2>Get In Touch</h2>
            <ul style="list-style: none; padding: 0;">
                <li style="margin-bottom: 1rem;"><strong>Email:</strong> <a href="mailto:berlinphoton@gmail.com">berlinphoton@gmail.com</a></li>
                <li style="margin-bottom: 1rem;"><strong>LinkedIn:</strong> <a href="https://www.linkedin.com/in/bilal-abboud/" target="_blank">linkedin.com/in/bilal-abboud</a></li>
                <li style="margin-bottom: 1rem;"><strong>GitHub:</strong> <a href="https://github.com/santoabboud" target="_blank">github.com/santoabboud</a></li>
            </ul>
        </div>
    </main>

    <div id="viewer-modal" class="viewer-modal-overlay">
        <div class="viewer-modal-content">
            <div class="viewer-modal-header">
                <h2 class="bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-teal-300">Atomic Spectra Viewer</h2>
                <span id="viewer-modal-close" class="viewer-modal-close">&times;</span>
            </div>
            <div class="viewer-modal-body">
                <div class="flex flex-col lg:flex-row gap-6 h-full">
                    <div id="spectrum-panel" class="lg:flex-1 bg-gray-800 p-4 rounded-lg shadow-lg flex flex-col" style="height: 40vh;">
                         <h2 class="text-xl font-semibold mb-2 text-center">Spectrum View: <span id="current-element" class="font-bold text-white">None</span></h2>
                        <div id="spectrum-display" class="flex-grow relative min-h-[150px]">
                            <canvas id="spectrum-canvas" class="w-full h-full bg-black rounded-lg cursor-grab active:cursor-grabbing"></canvas>
                            <div id="wavelength-tooltip" class="absolute bg-gray-700 text-white text-xs rounded py-1 px-2 pointer-events-none opacity-0 transition-opacity"></div>
                        </div>
                         <div class="text-center mt-2 text-sm text-gray-400">Scroll to zoom, drag to pan.</div>
                         <div id="resize-handle" class="resize-handle"></div>
                    </div>
                    <div class="lg:w-[450px] flex-shrink-0 space-y-6">
                        <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
                             <h2 class="text-xl font-semibold mb-3 text-center">Load Data</h2>
                             <div class="flex flex-col items-center">
                                 <label for="json-upload" class="file-upload-btn text-center font-semibold">Upload Fallback JSON</label>
                                 <input type="file" id="json-upload" class="hidden" accept=".json">
                                 <p id="upload-status" class="text-sm text-gray-400 mt-2">Loading data...</p>
                             </div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
                            <h2 class="text-xl font-semibold mb-3 text-center">Select Element(s)</h2>
                            <div id="periodic-table" class="periodic-table-grid"></div>
                             <div id="category-legend" class="flex flex-wrap justify-center gap-x-2 gap-y-1 mt-3 text-xs"></div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
                            <h2 class="text-xl font-semibold mb-4 text-center">Tools</h2>
                            <div class="space-y-4">
                                <div>
                                     <label for="compare-toggle" class="flex items-center cursor-pointer">
                                        <div class="relative">
                                            <input type="checkbox" id="compare-toggle" class="sr-only">
                                            <div class="block bg-gray-600 w-14 h-8 rounded-full transition-colors"></div>
                                            <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"></div>
                                        </div>
                                        <div class="ml-3 text-gray-200 font-medium">Compare Mode (Max 3)</div>
                                    </label>
                                    <div id="comparison-list" class="mt-2 space-y-2"></div>
                                </div>
                                <div>
                                    <h3 class="font-semibold mb-2 text-center">Line Finder</h3>
                                    <div class="flex flex-col sm:flex-row gap-2">
                                        <input type="number" id="wavelength-input" placeholder="Wavelength (nm)" class="bg-gray-700 border border-gray-600 rounded-lg px-3 py-1.5 w-full text-sm focus:ring-blue-500 focus:border-blue-500">
                                        <input type="number" id="tolerance-input" placeholder="Tolerance (±nm)" value="0.1" class="bg-gray-700 border border-gray-600 rounded-lg px-3 py-1.5 w-full text-sm focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <button id="find-btn" class="mt-2 w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Find Elements</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="finder-modal" class="finder-modal">
        <div class="finder-modal-content">
            <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold">Finder Results</h2><span class="modal-close" id="finder-modal-close-btn">&times;</span></div>
            <div id="finder-modal-results" class="max-h-96 overflow-y-auto pr-2"></div>
        </div>
    </div>

    <div id="project-storage" style="display: none;">
        <div class="project-data" data-category="spectroscopy">
            <div class="preview-content">
                <img class="preview-image" src="https://via.placeholder.com/150x100.png?text=LIBS+Plot" alt="Cover image for LIBS Analyzer project">
                <div class="preview-text-content">
                    <h3>Python LIBS Analyzer</h3>
                    <p>A custom Python script developed for processing and analyzing Laser-Induced Breakdown Spectroscopy (LIBS) data. This tool automates peak detection, baseline correction, and elemental identification...</p>
                </div>
            </div>
            <div class="full-content">
                <h3>Python LIBS Analyzer</h3>
                <p>This project involved the development of a Python script to streamline the analysis of data from a Laser-Induced Breakdown Spectroscopy (LIBS) setup. Manually processing spectral data can be tedious, so this tool was created to automate several key steps.</p>
                <h4>Core Features</h4>
                <ul>
                    <li><strong>Baseline Correction:</strong> Implements an adaptive iterative reweighted penalized least squares (airPLS) algorithm to remove complex background noise.</li>
                    <li><strong>Peak Detection:</strong> Uses SciPy's `find_peaks` function with adjustable parameters for prominence and width to accurately identify spectral lines.</li>
                    <li><strong>Elemental Identification:</strong> Compares detected peaks against a spectral database (like the NIST data) to suggest possible elemental compositions.</li>
                    <li><strong>Data Visualization:</strong> Generates plots of the raw spectrum, the corrected baseline, and the final spectrum with identified peaks labeled.</li>
                </ul>
                <h4>Example Python Code Snippet</h4>
                <pre><code>import numpy as np
from scipy.sparse import csc_matrix, eye, diags
from scipy.sparse.linalg import spsolve

def WhittakerSmooth(x,w,lambda_):
    X=np.matrix(x)
    m=X.size
    i=np.arange(0,m)
    E=eye(m,format='csc')
    D=E[1:,:]-E[:-1,:]
    W=diags(w,0,shape=(m,m))
    A=csc_matrix(W+(lambda_*D.T*D))
    z=spsolve(A,w*x)
    return z

def airPLS(x, lambda_=100, p=0.01, m=None):
    if m is None:
        m = x.shape[0]
    w = np.ones(m)
    for i in range(1, 15):
        z = WhittakerSmooth(x, w, lambda_)
        d = x - z
        dssn = np.abs(d[d < 0].sum())
        if(dssn < 0.001 * (abs(x)).sum()):
            break
        w[d >= 0] = 0
        w[d < 0] = p * np.exp(i * np.abs(d[d < 0]) / dssn)
        w[0] = p * np.exp(i * np.abs(d[d < 0]).max() / dssn)
    return z
</code></pre>
                <p>The script significantly reduces analysis time and provides a consistent method for evaluating LIBS data, making it a valuable tool for rapid material screening.</p>
            </div>
        </div>
        <div class="project-data" data-category="spectroscopy">
             <div class="preview-content"> <img class="preview-image" src="https://github.com/user-attachments/assets/eb921588-6b9b-4bfe-9254-a1c86b63da56" alt="Cover image for USB2000 project"> <div class="preview-text-content"> <h3>Ocean Optics USB2000 Firmware update</h3> <p>This is a compilation of info about Ocean Optics USB2000 spectrometers and a guide to flashing them with firmware on the board level. The Ocean Optics USB2000 is a compact crossed Czerny-Turner type spectrometer...</p> </div> </div>
            <div class="full-content"></div>
        </div>
        <div class="project-data" data-category="microscopy">
             <div class="preview-content"> <img class="preview-image" src="https://raw.githubusercontent.com/santoabboud/santoabboud.github.io/main/assets/img/FS70L4_rightside.jpg" alt="Cover image for Frankenscope"> <div class="preview-text-content"> <h3>The Frankenscope: A Microscopic Multi-tool</h3> <p>This Microscope consists of a Mitutoyo FS70L4 as its core and a Physik Instrumente six-axis closed-loop piezo hexapod stage. It is currently equipped with a passively q-switched 1064nm DPSS laser...</p> </div> </div>
            <div class="full-content"></div>
        </div>
        <div class="project-data" data-category="night-vision">
             <div class="preview-content"> <img class="preview-image" src="https://via.placeholder.com/150x100.png?text=NV+Device" alt="Cover image for night vision project"> <div class="preview-text-content"> <h3>DIY Digital Night Vision Monocular</h3> <p>A project exploring the construction of a digital night vision device using a sensitive CMOS sensor and an infrared illuminator. The goal was to create a compact and affordable alternative to commercial units...</p> </div> </div>
            <div class="full-content"></div>
        </div>
    </div>

    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script>
    // Main site navigation script
    document.addEventListener('DOMContentLoaded', () => {
        const logoLink = document.getElementById('logo-link');
        const mainNavLinks = document.querySelectorAll('.main-nav .nav-link');
        const contentPanels = document.querySelectorAll('.main-content .content-panel');
        const projectsPanel = document.getElementById('projects');
        const breadcrumbsEl = projectsPanel.querySelector('.breadcrumbs');
        const categoryListEl = projectsPanel.querySelector('#category-list');
        const projectListEl = projectsPanel.querySelector('#project-list');
        const projectFullViewEl = projectsPanel.querySelector('#project-full-view');
        const allProjectData = document.querySelectorAll('#project-storage .project-data');
        const launchNistViewerBtn = document.getElementById('launch-nist-viewer');
        const viewerModal = document.getElementById('viewer-modal');
        const viewerModalClose = document.getElementById('viewer-modal-close');

        function updateActiveNavLink(targetId) { mainNavLinks.forEach(l => l.classList.remove('active')); const activeLink = document.querySelector(`.main-nav .nav-link[data-target="${targetId}"]`); if (activeLink) activeLink.classList.add('active'); }
        function showPanel(panelId) { contentPanels.forEach(p => p.classList.remove('active')); const targetPanel = document.getElementById(panelId); if(targetPanel) targetPanel.classList.add('active'); updateActiveNavLink(panelId); }
        function showProjectsView(view, context = {}) {
            projectsPanel.querySelectorAll('.view').forEach(v => v.style.display = 'none');
            let currentViewEl;
            switch(view) {
                case 'categories': currentViewEl = categoryListEl; breadcrumbsEl.innerHTML = `<span>Projects</span>`; break;
                case 'project-list': currentViewEl = projectListEl; breadcrumbsEl.innerHTML = `<span>Projects</span> &gt; ${context.categoryName}`; populateProjectList(context.category); break;
                case 'full-project': currentViewEl = projectFullViewEl; breadcrumbsEl.innerHTML = `<span>Projects</span> &gt; <span data-category-id="${context.category}" data-category-name="${context.categoryName}">${context.categoryName}</span> &gt; ${context.projectName}`; populateFullProjectView(context); break;
            }
            if (currentViewEl) currentViewEl.style.display = 'block';
        }

        logoLink.addEventListener('click', e => { e.preventDefault(); showPanel('projects'); showProjectsView('categories'); });
        mainNavLinks.forEach(link => { link.addEventListener('click', e => { e.preventDefault(); const targetId = link.getAttribute('data-target'); showPanel(targetId); if (targetId === 'projects') showProjectsView('categories'); }); });
        breadcrumbsEl.addEventListener('click', e => { if (e.target.tagName !== 'SPAN') return; const text = e.target.textContent; if (text === 'Projects') { showProjectsView('categories'); } else { const categoryId = e.target.getAttribute('data-category-id'); const categoryName = e.target.getAttribute('data-category-name'); if (categoryId && categoryName) showProjectsView('project-list', { category: categoryId, categoryName: categoryName }); } });
        categoryListEl.querySelectorAll('.category-card').forEach(card => { card.addEventListener('click', () => { const categoryId = card.getAttribute('data-category'); const categoryName = card.querySelector('h3').textContent; showProjectsView('project-list', { category: categoryId, categoryName: categoryName }); }); });
        
        function populateProjectList(categoryId) {
            projectListEl.innerHTML = '';
            allProjectData.forEach((projectNode, index) => {
                if (projectNode.getAttribute('data-category') === categoryId) {
                    const previewHTML = projectNode.querySelector('.preview-content').innerHTML;
                    const previewCard = document.createElement('div');
                    previewCard.className = 'project-preview';
                    previewCard.innerHTML = previewHTML;
                    previewCard.setAttribute('data-project-index', index);
                    previewCard.addEventListener('click', () => { const projectName = projectNode.querySelector('.preview-content h3').textContent; const categoryName = breadcrumbsEl.textContent.split('>')[1].trim(); showProjectsView('full-project', { projectIndex: index, projectName, category: categoryId, categoryName }); });
                    projectListEl.appendChild(previewCard);
                }
            });
        }
        function populateFullProjectView(context) {
            const projectData = allProjectData[context.projectIndex];
            const fullContentHTML = projectData.querySelector('.full-content').innerHTML;
            const backButton = document.createElement('button');
            backButton.className = 'back-button';
            backButton.textContent = `← Back to ${context.categoryName}`;
            backButton.onclick = () => showProjectsView('project-list', { category: context.category, categoryName: context.categoryName });
            projectFullViewEl.innerHTML = '';
            projectFullViewEl.appendChild(backButton);
            const contentWrapper = document.createElement('div');
            contentWrapper.className = 'blog-post-content';
            contentWrapper.innerHTML = fullContentHTML;
            projectFullViewEl.appendChild(contentWrapper);
        }

        // NIST Viewer Modal Logic
        launchNistViewerBtn.addEventListener('click', () => viewerModal.style.display = 'flex');
        viewerModalClose.addEventListener('click', () => viewerModal.style.display = 'none');
        window.addEventListener('click', (e) => { if (e.target === viewerModal) viewerModal.style.display = 'none'; });
    });

    // NIST Viewer Application Script (self-contained)
    (function() {
        if (document.getElementById('spectrum-canvas')) { // Check if viewer elements exist
            let atomicData = {};
            let visiblePeaks = [];
            const spectrumPanel = document.getElementById('spectrum-panel');
            const resizeHandle = document.getElementById('resize-handle');
            const periodicTableContainer = document.getElementById('periodic-table');
            const categoryLegendContainer = document.getElementById('category-legend');
            const spectrumCanvas = document.getElementById('spectrum-canvas');
            const wavelengthTooltip = document.getElementById('wavelength-tooltip');
            const currentElementSpan = document.getElementById('current-element');
            const jsonUploadInput = document.getElementById('json-upload');
            const uploadStatus = document.getElementById('upload-status');
            const compareToggle = document.getElementById('compare-toggle');
            const comparisonListDiv = document.getElementById('comparison-list');
            const findBtn = document.getElementById('find-btn');
            const wavelengthInput = document.getElementById('wavelength-input');
            const toleranceInput = document.getElementById('tolerance-input');
            const finderModal = document.getElementById('finder-modal');
            const finderModalResults = document.getElementById('finder-modal-results');
            const modalCloseBtn = document.getElementById('finder-modal-close-btn');

            let appState = { isCompareMode: false, selectedElements: [], maxCompare: 3 };
            let viewState = { minWavelength: 200, maxWavelength: 1000, isDragging: false, lastX: 0 };
            const ctx = spectrumCanvas.getContext('2d');

            const elements = [ /* Full elements array from your file */ ];
            const categories = { /* Full categories object from your file */ };
            
            function processLoadedData(data) {
                atomicData = data;
                uploadStatus.textContent = `✅ Data loaded automatically from repository.`;
                uploadStatus.classList.remove('text-gray-400');
                uploadStatus.classList.add('text-green-400');
                createPeriodicTable();
            }

            async function loadInitialData() {
                const dataUrl = 'https://raw.githubusercontent.com/santoabboud/santoabboud.github.io/main/assets/img/nist_atomic_data.json';
                try {
                    const response = await fetch(dataUrl);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    processLoadedData(data);
                } catch (error) {
                    console.error("Error fetching initial data:", error);
                    uploadStatus.textContent = `❌ Auto-load failed. Please upload file manually.`;
                    uploadStatus.classList.add('text-red-400');
                    createPeriodicTable(); // Create disabled table
                }
            }

            function handleFileUpload(event) { /* Function from your file */ }
            function createPeriodicTable() { /* Function from your file */ }
            function createCategoryLegend() { /* Function from your file */ }
            function resizeCanvas() { /* Function from your file */ }
            function handleElementClick(symbol) { /* Function from your file */ }
            function handleCompareModeToggle() { /* Function from your file */ }
            function findDataForElement(symbol) { /* Function from your file */ }
            function drawSpectra() { /* Function from your file */ }
            function handlePan(e) { /* Function from your file */ }
            function handleZoom(e) { /* Function from your file */ }
            function showWavelengthTooltip(e) { /* Function from your file */ }
            function handleFind() { /* Function from your file */ }
            function displayFinderResults(results, target, tolerance) { /* Function from your file */ }
            function updateUI() { /* Function from your file */ }
            function wavelengthToRgb(wavelength) { /* Function from your file */ }

            // Initial setup for the viewer
            createCategoryLegend();
            resizeCanvas();
            drawSpectra();
            loadInitialData();
            
            // All event listeners from your file...
            jsonUploadInput.addEventListener('change', handleFileUpload);
            compareToggle.addEventListener('change', handleCompareModeToggle);
            // ... and so on for all other listeners.
        }
    })();
    </script>
</body>
</html>
